<!DOCTYPE HTML>
<html lang=en>
    <meta charset="utf-8">
    <title>Nintendo Gallery Checklist (The Wind Waker HD)</title>
    <style>
        .gallery-room { max-width: max-content; text-align: center; }
        .figurine-row { margin-block: 16px; }
        .figurine { display: inline-block; margin-block: unset; }
        .description { color: dimgray; }
        
        @counter-style trips { system: extends decimal; prefix: "Trip "; }
        .route { list-style: trips; padding-left: 8ch; }
        .trip-list { list-style: none; padding-left: 0; }
        
        /* If we can fit anything worthwhile while still leaving a couple
           lines of the route visible, then lift it up into the viewport.
           Otherwise, don't bother, but make sure this threshold is set very
           reasonably.*/
        #skipped-figurines { position: sticky; bottom: 0; top: 2em;
                             max-height: min(100vh - 6em, 50vh); min-height: 2em;
                             overflow-y: auto; background: white; margin-bottom: 1em; }
        #skipped-figurines > legend { background: white; }
        fieldset > .trip-list { margin-block: 0; }
        
        summary { cursor: pointer; user-select: none; }
    </style>
    <div id=react-root></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script>
        const figurineInfo = {
            'linder': { displayName: 'Linder' },
            'aldo': { displayName: 'Aldo' },
            'oakin': { displayName: 'Oakin' },
            'carlov': { displayName: 'Carlov the Sculptor' },
            'manny': { displayName: 'Manny' },
            'drona': { displayName: 'Drona' },
            'rown': { displayName: 'Rown' },
            'irch': { displayName: 'Irch' },
            'elma': { displayName: 'Elma' },
            'hollo': { displayName: 'Hollo' },
            'olivio': { displayName: 'Olivio' },
            'fado': { displayName: 'Fado' },
            'deku tree': { displayName: 'Deku Tree' },
            'makar': { displayName: 'Makar' },
            'hoskit': { displayName: 'Hoskit' },
            'quill': { displayName: 'Quill the Postman', useInstead: 'chieftain' },
            'valoo': { displayName: 'Valoo' },
            'zephos & cyclos': { displayName: 'Zephos & Cyclos' },
            'baito': { displayName: 'Baito' },
            'chieftain': { displayName: 'The Rito Chieftain' },
            'ilari': { displayName: 'Ilari' },
            'koboli': { displayName: 'Koboli' },
            'laruto': { displayName: 'Laruto' },
            'komali': { displayName: 'Komali' },
            'namali': { displayName: 'Namali' },
            'skett & akoot': { displayName: 'Skett & Akoot' },
            'medli': { displayName: 'Medli' },
            'basht & bisht': { displayName: 'Basht & Bisht' },
            'pashli': { displayName: 'Pashli' },
            'obli': { displayName: 'Obli' },
            'kogoli': { displayName: 'Kogoli' },
            'willi': { displayName: 'Willi' },
            'armos': { displayName: 'Armos' },
            'armos knight': { displayName: 'Armos Knight' },
            'morth': { displayName: 'Morth' },
            'poe': { displayName: 'Poe' },
            'redead': { displayName: 'ReDead' },
            'gyorg': { displayName: 'Gyorg' },
            'octorok': { displayName: 'Octorok' },
            'seahat': { displayName: 'Seahat' },
            'kargaroc': { displayName: 'Kargaroc' },
            'miniblin': { displayName: 'Miniblin' },
            'chuchu': { displayName: 'ChuChu' },
            'peahat': { displayName: 'Peahat' },
            'rat': { displayName: 'Rat' },
            'boko baba': { displayName: 'Boko Baba' },
            'keese': { displayName: 'Keese & Fire Keese' },
            'bokoblin': { displayName: 'Bokoblin' },
            'bubble': { displayName: 'Red Bubble & Blue Bubble' },
            'floor master': { displayName: 'Floor Master' },
            'magtail': { displayName: 'Magtail' },
            'puppet ganon': { displayName: 'Puppet Ganon' },
            'molgera': { displayName: 'Molgera, Protector of the Seal' },
            'kalle demos': { displayName: 'Kalle Demos' },
            'gohma': { displayName: 'Gohma' },
            'big octo': { displayName: 'Big Octo' },
            'stalfos': { displayName: 'Stalfos' },
            'jalhalla': { displayName: 'Jalhalla, Protector of the Seal' },
            'ganondorf': { displayName: 'Ganondorf' },
            'helmaroc king': { displayName: 'The Monstrous Helmaroc King' },
            'mothula': { displayName: 'Mothula' },
            'mighty darknut': { displayName: 'Mighty Darknut' },
            'moblin': { displayName: 'Moblin' },
            'phantom ganon': { displayName: 'Phantom Ganon' },
            'orange wizzrobe': { displayName: 'Wizzrobe', description: 'Orange' },
            'darknut': { displayName: 'Darknut' },
            'wizzrobe': { displayName: 'Wizzrobe' },
            'no shield darknut': { displayName: 'Darknut', description: 'No Shield' },
            'gohdan': { displayName: 'Gohdan, the Great Arbiter' },
            'sue-belle': { displayName: 'Sue-Belle' },
            'seagull': { displayName: 'Seagull' },
            'aryll': { displayName: 'Aryll', useInstead: 'grandma' },
            'grandma': { displayName: 'Link\'s Grandma' },
            'sturgeon': { displayName: 'Sturgeon' },
            'wild pig': { displayName: 'Wild Pig' },
            'orca': { displayName: 'Orca' },
            'rose': { displayName: 'Rose' },
            'jabun': { displayName: 'Jabun' },
            'abe': { displayName: 'Abe' },
            'mesa': { displayName: 'Mesa' },
            'joel': { displayName: 'Joel' },
            'crab': { displayName: 'Crab' },
            'zill': { displayName: 'Zill' },
            'sam': { displayName: 'Sam' },
            'gillian': { displayName: 'Gillian' },
            'gossack': { displayName: 'Gossack' },
            'cannon': { displayName: 'Bomb-Master Cannon' },
            'doc bandam': { displayName: 'The Potion Master, Doc Bandam' },
            'kamo': { displayName: 'Kamo' },
            'gummy': { displayName: 'Gummy the Sailor' },
            'kane': { displayName: 'Kane the Sailor' },
            'dampa': { displayName: 'Dampa the Sailor' },
            'candy': { displayName: 'Candy the Sailor' },
            'linda': { displayName: 'Linda' },
            'maggie\'s father': { displayName: 'Maggie\'s Father' },
            'maggie': { displayName: 'Maggie' },
            'mila': { displayName: 'Mila' },
            'mila\'s father': { displayName: 'Mila\'s Father' },
            'killer bees': { displayName: 'Windfall\'s Gang of Boys, the Killer Bees' },
            'mrs. marie': { displayName: 'The Joyful Teacher, Mrs. Marie' },
            'potova & joanna': { displayName: 'Potova & Joanna' },
            'tott': { displayName: 'Tott' },
            'lenzo': { displayName: 'The Pictographer, Lenzo' },
            'garrickson': { displayName: 'Garrickson' },
            'zunari': { displayName: 'The Shop Guru, Zunari' },
            'pompie & vera': { displayName: 'Pompie & Vera' },
            'missy': { displayName: 'Missy' },
            'kreeb': { displayName: 'Kreeb' },
            'minenco': { displayName: 'Minenco' },
            'anton': { displayName: 'Anton' },
            'fishman': { displayName: 'Fishman' },
            'king of hyrule': { displayName: 'King of Hyrule' },
            'king of red lions': { displayName: 'Link & the King of Red Lions' },
            'princess zelda': { displayName: 'Princess Zelda', useInstead: 'king of hyrule' },
            'salvage corp.': { displayName: 'Salvage Corp.' },
            'tetra': { displayName: 'Tetra' },
            'salvatore': { displayName: 'Salvatore' },
            'gonzo': { displayName: 'Gonzo', useInstead: 'tetra' },
            'old man ho ho': { displayName: 'Old Man Ho Ho' },
            'loot': { displayName: 'Loot the Sailor' },
            'senza': { displayName: 'Senza', useInstead: 'tetra' },
            'traveling merchants': { displayName: 'Traveling Merchants' },
            'beedle': { displayName: 'Beedle' },
            'nudge': { displayName: 'Nudge', useInstead: 'tetra' },
            'queen of fairies': { displayName: 'Queen of Fairies' },
            'tingle': { displayName: 'Tingle' },
            'zuko': { displayName: 'Zuko', useInstead: 'tetra' },
            'great fairy': { displayName: 'Great Fairy' },
            'ankle': { displayName: 'Ankle' },
            'niko': { displayName: 'Niko', useInstead: 'tetra' },
            'fairy': { displayName: 'Fairy' },
            'david jr.': { displayName: 'David Jr.' },
            'mako': { displayName: 'Mako', useInstead: 'tetra' },
            'knuckle': { displayName: 'Knuckle' },
        };
        
        const gallery = {
            'Forest Haven': [
                ['linder', 'aldo', 'oakin', 'carlov', 'manny'],
                ['drona', 'rown', 'irch'],
                ['elma', 'hollo', 'olivio'],
                ['fado', 'deku tree'],
                ['makar'],
            ],
            'Dragon Roost Island': [
                ['hoskit', 'quill', 'valoo', 'zephos & cyclos'],
                ['baito', 'chieftain', 'ilari'],
                ['koboli', 'laruto', 'komali', 'namali'],
                ['skett & akoot', 'medli', 'basht & bisht'],
                ['pashli', 'obli'],
                ['kogoli', 'willi'],
            ],
            'Enemies': [
                ['armos', 'armos knight', 'morth', 'poe', 'redead'],
                ['gyorg', 'octorok', 'seahat', 'kargaroc'],
                ['miniblin', 'chuchu', 'peahat'],
                ['rat', 'boko baba'],
                ['keese', 'bokoblin', 'bubble'],
                ['floor master', 'magtail'],
            ],
            'Bosses & Mini-Bosses': [
                ['puppet ganon', 'molgera', 'kalle demos', 'gohma', 'big octo'],
                ['stalfos', 'jalhalla', 'ganondorf', 'helmaroc king', 'mothula'],
                ['mighty darknut', 'moblin', 'phantom ganon', 'orange wizzrobe'],
                ['darknut', 'wizzrobe'],
                ['no shield darknut', 'gohdan'],
            ],
            'Outset Island': [
                ['sue-belle', 'seagull', 'aryll', 'grandma'],
                ['sturgeon', 'wild pig'],
                ['orca', 'rose'],
                ['jabun', 'abe'],
                ['mesa', 'joel'],
                ['crab', 'zill'],
            ],
            'Windfall Island': [
                ['sam', 'gillian', 'gossack', 'cannon', 'doc bandam', 'kamo'],
                ['gummy', 'kane', 'dampa', 'candy', 'linda'],
                ['maggie\'s father', 'maggie', 'mila', 'mila\'s father'],
                ['killer bees', 'mrs. marie', 'potova & joanna'],
                ['tott', 'lenzo'],
                ['garrickson', 'zunari', 'pompie & vera'],
                ['missy', 'kreeb'],
                ['minenco', 'anton'],
            ],
            'The Great Sea': [
                ['fishman', 'king of hyrule', 'king of red lions', 'princess zelda', 'salvage corp.'],
                ['tetra', 'salvatore'],
                ['gonzo', 'old man ho ho', 'loot'],
                ['senza', 'traveling merchants', 'beedle'],
                ['nudge', 'queen of fairies', 'tingle'],
                ['zuko', 'great fairy', 'ankle'],
                ['niko', 'fairy', 'david jr.'],
                ['mako', 'knuckle'],
            ],
        };
        
        const route = [
            ['minenco', 'sam', 'pompie & vera', 'missy', 'maggie\'s father',
             'candy', 'kane', 'dampa', 'cannon', 'potova & joanna', 'octorok'],
            ['mothula', 'kalle demos', 'komali', 'gohma', 'helmaroc king',
             'tetra', 'miniblin', 'phantom ganon', 'mighty darknut',
             'puppet ganon', 'zephos & cyclos'],
            ['kreeb', 'maggie', 'mila', 'bubble', 'armos', 'armos knight',
             'gohdan', 'valoo', 'linda', 'zunari', 'fairy', 'rat'],
            ['basht & bisht', 'namali', 'pashli', 'chieftain', 'skett & akoot',
             'hoskit', 'baito', 'koboli', 'kogoli', 'medli', 'peahat',
             'seagull'],
            ['moblin', 'chuchu', 'redead', 'floor master', 'poe',
             'stalfos', 'jalhalla', 'crab', 'willi', 'obli', 'makar'],
            ['fishman', 'no shield darknut', 'darknut', 'wizzrobe',
             'orange wizzrobe', 'bokoblin', 'molgera', 'big octo'],
            ['grandma', 'abe', 'rose', 'zill', 'joel', 'keese', 'magtail',
             'morth', 'orca', 'sturgeon', 'sue-belle', 'mesa'],
            ['ilari', 'anton', 'gossack', 'gillian', 'fado', 'laruto', 'jabun',
             'great fairy', 'queen of fairies', 'ganondorf', 'king of hyrule',
             'lenzo'],
            ['mrs. marie', 'doc bandam', 'kamo', 'garrickson', 'killer bees',
             'salvatore', 'gummy', 'mila\'s father', 'wild pig', 'tott',
             'traveling merchants', 'old man ho ho'],
            ['hollo', 'irch', 'olivio', 'salvage corp.', 'linder', 'kargaroc',
             'elma', 'drona', 'rown', 'oakin', 'loot', 'aldo'],
            ['tingle', 'david jr.', 'ankle', 'knuckle', 'gyorg', 'seahat',
             'beedle', 'boko baba', 'deku tree', 'manny', 'carlov'],
        ];
        
        const e = React.createElement;
        
        function FigurineCheckbox(props) {
            const { displayName, description, useInstead } = figurineInfo[props.name] ?? {};
            // Implement final figurine logic here because I'm lazy.
            const finalFigurine = props.name === 'king of red lions';
            const disabled = finalFigurine || useInstead !== undefined;
            const lookupName = useInstead ?? props.name;
            const checked = !finalFigurine ? props.currentCheckedValues[lookupName]
                : Object.keys(props.currentCheckedValues).every((figurine) => {
                    return figurine === 'king of red lions' || props.currentCheckedValues[figurine];
                });
            
            return e('p', { className: 'figurine' },
                e('label', {},
                    e('input', { type: 'checkbox', disabled, checked, onChange: () => {
                        props.onChange(lookupName, !checked);
                    } }),
                    ` ${displayName}`,
                    description && e('span', { className: 'description' }, 
                        ` (${description})`,
                    ),
                ),
                ' ',
            );
        }
        
        function GalleryRoom(props) {
            return e('fieldset', { className: 'gallery-room' },
                e('legend', {}, props.name),
                props.rows.map((row, i) => {
                    return e('div', { className: 'figurine-row', key: i },
                        row.map((figurine) => e(React.Fragment, { key: figurine },
                            e(FigurineCheckbox, {
                                name: figurine,
                                currentCheckedValues: props.currentCheckedValues,
                                onChange: props.onChange,
                            }),
                            ' ',
                        )),
                    );
                }),
            );
        }
        
        function Gallery(props) {
            return e(React.Fragment, {},
                Object.keys(props.rooms).map((roomName) => {
                    return e(GalleryRoom, {
                        name: roomName,
                        rows: props.rooms[roomName],
                        currentCheckedValues: props.currentCheckedValues,
                        onChange: props.onChange,
                        key: roomName,
                    });
                }),
            );
        }
        
        function SingleTripList(props) {
            return e('ol', { className: 'trip-list' },
                props.figurines.map((figurine, i) => e('li', { key: i },
                    e(FigurineCheckbox, {
                        name: figurine,
                        currentCheckedValues: props.currentCheckedValues,
                        onChange: props.onChange,
                    }),
                )),
            );
        }
        
        function Route(props) {
            return e('ol', { className: 'route' },
                props.trips.map((trip, i) => e('li', { key: i },
                    e(SingleTripList, {
                        figurines: trip,
                        currentCheckedValues: props.currentCheckedValues,
                        onChange: props.onChange,
                    }),
                )),
            );
        }
        
        function RouteTracker(props) {
            // Get a list of any figurines that were probably accidentally
            // missed.
            const skippedFigurines = [];
            // Some very rough heuristics will tell us where the user likely
            // is in the route, and we will consider any figurines before that
            // point to be missed. Specifically, if a figurine is collected,
            // but least 3 of the preceding 4 figurines were not collected, it
            // was just gotten early. The user is at the furthest collected
            // figurine that was not just gotten early.
            let currentRoutePositionFigurine;
            const figurineSearchList = props.route.flat().reverse();
            for (const [i, figurine] of figurineSearchList.entries()) {
                if (!props.currentCheckedValues[figurine]) {
                    continue;
                }
                // The slice will stop at the end of the array (the beginning
                // of the route) if it gets there, which is what we want.
                let precedingFigurines = figurineSearchList.slice(i+1, i+5);
                let uncollectedPreceding = precedingFigurines.reduce((a, fig) => {
                    return props.currentCheckedValues[fig] ? a : a+1;
                }, 0);
                // If the figurine is collected and wasn't collected early,
                // then, since we are iterating in reverse order, it is the
                // furthest one, so we stop here.
                if (uncollectedPreceding < 3) {
                    currentRoutePositionFigurine = figurine;
                    break;
                }
            }
            
            // If this variable wasn't set, the user is at the very beginning
            // of the route, so nothing can be missed.
            if (currentRoutePositionFigurine) {
                for (let figurine of props.route.flat()) {
                    if (figurine === currentRoutePositionFigurine) {
                        break;
                    }
                    if (!props.currentCheckedValues[figurine]) {
                        skippedFigurines.push(figurine);
                    }
                }
            }
            
            return e(React.Fragment, {},
                e(Route, {
                    trips: props.route,
                    currentCheckedValues: props.currentCheckedValues,
                    onChange: props.onChange,
                }),
                skippedFigurines.length > 0 && e('fieldset', { id: 'skipped-figurines' },
                    e('legend', {}, 'Skipped Figurines'),
                    e('ul', { className: 'trip-list' },
                        skippedFigurines.map((figurine) => e('li', { key: figurine },
                            e(FigurineCheckbox, {
                                name: figurine,
                                currentCheckedValues: props.currentCheckedValues,
                                onChange: props.onChange,
                            }),
                        )),
                    ),
                ),
            );
        }
        
        class Tracker extends React.Component {
            constructor(props) {
                super(props);
                this.state = { collectedFigurines: Object.keys(figurineInfo).reduce((o, name) => {
                    return figurineInfo[name]['useInstead'] ? o
                    : { ...o, [name]: false}
                }, {})};
                this.updateCollected = this.updateCollected.bind(this);
            }
            
            updateCollected(figurine, state) {
                this.setState({ collectedFigurines: { ...this.state.collectedFigurines, [figurine]: state } });
            }
            
            render() {
                return e(React.Fragment, {},
                    e('details', { open: true },
                        e('summary', {}, 'Speedrun Route'),
                        e(RouteTracker, {
                            route: route,
                            currentCheckedValues: this.state.collectedFigurines,
                            onChange: this.updateCollected,
                        }),
                    ),
                    e('details', { open: true },
                        e('summary', {}, 'Nintendo Gallery'),
                        e(Gallery, {
                            rooms: gallery,
                            currentCheckedValues: this.state.collectedFigurines,
                            onChange: this.updateCollected,
                        }),
                    ),
                );
            }
        }
        
        const root = ReactDOM.createRoot(document.getElementById('react-root'));
        root.render(e(Tracker, {}));
    </script>
</html>
